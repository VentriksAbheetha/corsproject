<html>
<head>
    <link rel="stylesheet" href="log-file.css">
</head>
    <body>
            <form onsubmit="return submitHandler();">
                <select id="modules" >

                    <option value="MarketPlace Provider">MarketPlace Provider</option>
                    <option value="Collectors">Collectors</option>
                    <option value="License">License</option>
              </select>
                <button type="submit">SUBMIT</button>
            </form>

                <table>
                    <thead id="successHeadings">
                    <tr>
                        <th>API name</th>
                        <th>API Url</th>
                        <th>Status</th>
                    </tr>
                    </thead>
                    <tbody id="successLogs">

                    </tbody>
                </table>

                <table>
                    <thead id="errorHeadings">
                    <tr>
                        <th>API name</th>
                        <th>Error message</th>
                    </tr>
                    </thead>
                    <tbody id="errorLogs">

                    </tbody>
                </table>
            <div id="logs">

            </div>
            <div id="loading" style="display: none;">Loading ....</div>
        <script>
            function submitHandler(){
                console.log('Submithandler');
                window.location.href= `http://localhost:5000/logs/${document.getElementById('modules').value}`;
                // getLogs(document.getElementById('modules').value).then((r)=>{
                //     r.forEach((log) => {
                //         console.log(log);
                //         let ele = document.createElement('div')
                //         document.getElementById('logs').appendChild(ele);
                //         ele.innerHTML = `${log}`
                //     })
                    // console.log(r)
                // })
                return false;
            }


            // window.onload = function f() {
            //     fetch('/logs', {
            //         method: 'GET', // or 'PUT'
            //
            //     })
            //         .then((response) => response.json())
            //         .then((data) => {
            //             data.forEach((log) => {
            //                 console.log(log);
            //                 let ele = document.createElement('div');
            //                 ele.innerHTML = "hiiiiii"
            //             })
            //             document.getElementById('logs').innerText = `${data[0]}`
            //             console.log('Success:', data);
            //         })
            //         .catch((error) => {
            //             console.error('Error:', error);
            //         });
            // }
            // let dropdown = document.getElementById('modules')
            // let selectedModule = document.getElementById('modules').value;
            // dropdown.onchange =  getLogs(selectedModule);

                async function getLogs(module) {
                try {
                    let response = await fetch(`/api/logs/${module}`);
                    let logs = await response.json();
                    return logs;

                } catch (error) {

                    return null;
                }


            }

            let moduleName = window.decodeURIComponent(window.location.pathname).substring(6);

            if(window.location.pathname !== "/") {

                document.getElementById('loading').style.display = 'block';

                document.getElementById('modules').value = moduleName;

                getLogs(moduleName).then((r) => {

                        r.succesLogs.forEach((log) => {
                                let successLogs = document.createElement('tr');
                                let tbody = document.getElementById('successLogs');
                                tbody.appendChild(successLogs);

                                let apiName = document.createElement('td')
                                let apiUrl = document.createElement('td')
                                let status = document.createElement('td')

                                successLogs.appendChild(apiName);
                                successLogs.appendChild(apiUrl);
                                successLogs.appendChild(status);

                                apiName.innerHTML = `${log.apiName}`
                                apiUrl.innerHTML = `${log.apiUrl}`
                                status.innerHTML = `${log.statusCheck}`


                            // console.log(log);
                            // let ele = document.createElement('div')
                            // document.getElementById('logs').appendChild(ele);
                            // ele.innerHTML = `${log.apiName}`
                        })

                })

                getLogs(moduleName).then((r) => {

                    r.errorLogs.forEach((log) => {
                        let successLogs = document.createElement('tr');
                        let tbody = document.getElementById('errorLogs');
                        tbody.appendChild(successLogs);

                        let apiName = document.createElement('td')
                        let error = document.createElement('td')

                        successLogs.appendChild(apiName);
                        successLogs.appendChild(error);

                        apiName.innerHTML = `${log.apiName}`
                        error.innerHTML = `${log.error}`


                    })

                })


            }


        </script>

    </body>
</html>

